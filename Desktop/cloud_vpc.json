{
   "AWSTemplateFormatVersion" : "2010-09-09",
   "Resources" : {
      "myVPC" : {
         "Type" : "AWS::EC2::VPC",
         "Properties" : {
            "CidrBlock" : "10.0.0.0/16",
    	    "EnableDnsSupport" : "false",
    	    "EnableDnsHostnames" : "false",
            "InstanceTenancy" : "default",
            "Tags" : [ {"Key" : "Name", "Value" : "PE_RM"} ],
	    "Fn::GetAZs" : "us-east-1" 
         }
      },
      "PublicSubnet" : {
         "Type" : "AWS::EC2::Subnet",
         "Properties" : {
            "VpcId" : { "Ref" : "myVPC" },
            "CidrBlock" : "10.0.0.0/20",
            "AvailabilityZone" : "us-east-2a",
            "Tags" : [ { "Key" : "Name", "Value" : "Public_Subnet" } ]
         }
      },
      "PrivateSubnet1" : {
         "Type" : "AWS::EC2::Subnet",
         "Properties" : {
            "VpcId" : { "Ref" : "myVPC" },
            "CidrBlock" : "10.0.16.0/20",
            "AvailabilityZone" : "us-east-2a",
            "Tags" : [ { "Key" : "Name", "Value" : "Private_Subnet1" } ]
         }
      },
      "IsolatedSubnet1" : {
         "Type" : "AWS::EC2::Subnet",
         "Properties" : {
            "VpcId" : { "Ref" : "myVPC" },
            "CidrBlock" : "10.0.32.0/20",
            "AvailabilityZone" : "us-east-2a",
            "Tags" : [ { "Key" : "Name", "Value" : "Isolated_Subnet1" } ]
         }
      },
      "PrivateSubnet2" : {
         "Type" : "AWS::EC2::Subnet",
         "Properties" : {
            "VpcId" : { "Ref" : "myVPC" },
            "CidrBlock" : "10.0.48.0/20",
            "AvailabilityZone" : "us-east-2b",
            "Tags" : [ { "Key" : "Name", "Value" : "Private_Subnet2" } ]
         }
      },
      "IsolatedSubnet2" : {
         "Type" : "AWS::EC2::Subnet",
         "Properties" : {
            "VpcId" : { "Ref" : "myVPC" },
            "CidrBlock" : "10.0.64.0/20",
            "AvailabilityZone" : "us-east-2b",
            "Tags" : [ { "Key" : "Name", "Value" : "Isolated_Subnet2" } ]
         }
      },
      "PrivateSubnet3" : {
         "Type" : "AWS::EC2::Subnet",
         "Properties" : {
            "VpcId" : { "Ref" : "myVPC" },
            "CidrBlock" : "10.0.80.0/20",
            "AvailabilityZone" : "us-east-2c",
            "Tags" : [ { "Key" : "Name", "Value" : "Private_Subnet3" } ]
         }
      },
      "IsolatedSubnet3" : {
         "Type" : "AWS::EC2::Subnet",
         "Properties" : {
            "VpcId" : { "Ref" : "myVPC" },
            "CidrBlock" : "10.0.96.0/20",
            "AvailabilityZone" : "us-east-2c",
            "Tags" : [ { "Key" : "Name", "Value" : "Isolated_Subnet3" } ]
         }
      },
      "myInternetGateway" : {
         "Type" : "AWS::EC2::InternetGateway",
         "Properties" : {
	    "VpcId" : { "Ref" : "myVPC" },	
            "Tags" : [ {"Key" : "Name", "Value" : "igw"}]
         }
      },
      "myPrivateRouteTable" : {
         "Type" : "AWS::EC2::RouteTable",
         "Properties" : {
            "VpcId" : { "Ref" : "myVPC" },
            "Tags" : [ { "Key" : "Name", "Value" : "Private_Route_Table" } ]
         }
      },
      "myPublicRouteTable" : {
         "Type" : "AWS::EC2::RouteTable",
         "Properties" : {
            "VpcId" : { "Ref" : "myVPC" },
            "Tags" : [ { "Key" : "Name", "Value" : "Public_Route_Table" } ]
         }
      },
      "PublicRoute" : {
         "Type" : "AWS::EC2::Route",
         "DependsOn" : "GatewayToInternet",
         "Properties" : {
            "RouteTableId" : { "Ref" : "myPublicRouteTable" },
            "DestinationCidrBlock" : "0.0.0.0/0",
            "GatewayId" : { "Ref" : "myInternetGateway" }
         }
      },
      "publicAssociation" : {
         "Type" : "AWS::EC2::SubnetRouteTableAssociation",
         "Properties" : {
            "SubnetId" : { "Ref" : "PublicSubnet" },
            "RouteTableId" : { "Ref" : "myPublicRouteTable" }
         }
      },
      "NAT" : {
  	"DependsOn" : "VPCGatewayAttach",
  	"Type" : "AWS::EC2::NatGateway",
  	"Properties" : {
    	    "AllocationId" : { "Fn::GetAtt" : ["EIP", "AllocationId"]},
    	    "SubnetId" : { "Ref" : "PublicSubnet"},
            "Tags" : [ {"Key" : "Name", "Value" : "NAT_GW_ID" } ]
	      }
      },
     "EIP" : {
  	"Type" : "AWS::EC2::EIP",
  	"Properties" : {
    	"Domain" : "vpc"
     		}
     },
     "PrivateRoute" : {
  	"Type" : "AWS::EC2::Route",
  	"Properties" : {
    	"RouteTableId" : { "Ref" : "myPrivateRouteTable" },
    	"DestinationCidrBlock" : "0.0.0.0/0",
    	"NatGatewayId" : { "Ref" : "NAT" }
  	}
     },
     "privateAssociation1" : {
         "Type" : "AWS::EC2::SubnetRouteTableAssociation",
         "Properties" : {
            "SubnetId" : { "Ref" : "PrivateSubnet1" },
            "RouteTableId" : { "Ref" : "myPrivateRouteTable" }
         }
      },
     "privateAssociation2" : {
         "Type" : "AWS::EC2::SubnetRouteTableAssociation",
         "Properties" : {
            "SubnetId" : { "Ref" : "PrivateSubnet2" },
            "RouteTableId" : { "Ref" : "myPrivateRouteTable" }
         }
      },
      "privateAssociation3" : {
         "Type" : "AWS::EC2::SubnetRouteTableAssociation",
         "Properties" : {
            "SubnetId" : { "Ref" : "PrivateSubnet3" },
            "RouteTableId" : { "Ref" : "myPrivateRouteTable" }
         }
      }     
   }
}
